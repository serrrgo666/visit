<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>USDT Amount Calculator</title>
<style>
  :root{
    --bg:#0b0f14;
    --card:#0f1720;
    --muted:#9aa6b2;
    --accent:#23d27a;
    --accent-2:#da4b48;
    --glass: rgba(255,255,255,0.03);
  }
  *{box-sizing:border-box}
  body {
    margin: 0;
    padding: 20px;
    font-family: Inter, ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
    background: radial-gradient(1200px 600px at 10% 10%, rgba(35,210,122,0.06), transparent 8%),
                radial-gradient(900px 500px at 90% 90%, rgba(218,75,72,0.04), transparent 6%),
                var(--bg);
    color: #e6edf3;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    min-height: 100vh;
  }

  .container {
    width: 100%;
    max-width: 560px;
    background: linear-gradient(180deg,var(--card), #0b1116);
    padding: 22px;
    border-radius: 14px;
    margin-top: 28px;
    box-shadow: 0 8px 30px rgba(2,6,23,0.7), 0 0 0 1px rgba(255,255,255,0.02) inset;
    border: 1px solid rgba(255,255,255,0.02);
  }

  .header{display:flex;gap:12px;align-items:center}
  h1{font-size:18px;margin:0;color:var(--accent)}
  .subtitle{color:var(--muted);font-size:13px}

  .candles{display:flex;gap:6px;margin-left:auto}
  .candle{width:10px;display:flex;flex-direction:column;align-items:center}
  .wick{width:2px;height:12px;background:var(--muted);opacity:0.8;margin-bottom:2px}
  .body-green{width:10px;height:28px;background:linear-gradient(180deg,#23a95a,#238636);border-radius:2px}
  .body-red{width:10px;height:20px;background:linear-gradient(180deg,#e05a57,#da3633);border-radius:2px}

  form{margin-top:16px;display:grid;grid-template-columns:1fr 1fr;gap:12px}
  label{display:block;color:var(--muted);font-size:13px;margin-bottom:6px}
  .full{grid-column:1/-1}

  input{
    width:100%;padding:10px 12px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:var(--glass);color:inherit;font-size:15px
  }

  .controls{display:flex;gap:10px;margin-top:14px}
  .btn{flex:1;padding:10px 12px;border-radius:10px;border:0;cursor:pointer;font-weight:600}
  .btn-primary{background:linear-gradient(180deg,var(--accent),#1fa95f);color:#042014}
  .btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)}
  .small{flex:0 0 auto;padding:8px 10px}

  .result{margin-top:16px;padding:14px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.03);font-size:16px;text-align:center}
  .error{color:#ffb3b3;font-size:13px;margin-top:8px;text-align:center}

  @media (max-width:720px){
    form{grid-template-columns:1fr;}
    .candles{display:none}
    .container{margin-top:18px;padding:18px}
  }
</style>
</head>
<body>
  <div class="container" role="application" aria-label="USDT amount calculator">
    <div class="header">
      <div>
        <h1>USDT Amount Calculator</h1>
        <div class="subtitle">amountUSDT = RiskUSD / (Leverage * ((Entry - Stop) / Entry))</div>
      </div>

      <div class="candles" aria-hidden="true">
        <div class="candle"><div class="wick"></div><div class="body-green"></div></div>
        <div class="candle"><div class="wick"></div><div class="body-red"></div></div>
        <div class="candle"><div class="wick"></div><div class="body-green" style="height:34px"></div></div>
        <div class="candle"><div class="wick"></div><div class="body-red" style="height:18px"></div></div>
      </div>
    </div>

    <form id="calcForm" onsubmit="return false;" aria-describedby="helpText">
      <div>
        <label for="risk">Риск (USD)</label>
        <input id="risk" name="risk" inputmode="decimal" placeholder="Например: 50" />
      </div>

      <div>
        <label for="leverage">Плечо (Leverage)</label>
        <input id="leverage" name="leverage" inputmode="decimal" placeholder="Например: 10" />
      </div>

      <div class="full">
        <label for="entry">Вход (Entry)</label>
        <input id="entry" name="entry" inputmode="decimal" placeholder="Например: 20000" />
      </div>

      <div class="full">
        <label for="stop">Стоп (Stop)</label>
        <input id="stop" name="stop" inputmode="decimal" placeholder="Например: 19800" />
      </div>

      <div class="controls full">
        <button id="calc" type="button" class="btn btn-primary">Рассчитать</button>
        <button id="clear" type="button" class="btn btn-ghost small">Очистить</button>
        <button id="copy" type="button" class="btn btn-ghost small">Копировать</button>
      </div>
    </form>

    <div id="out" class="result" role="status">amount = —</div>
    <div id="error" class="error" aria-live="polite"></div>
    <div id="helpText" class="subtitle" style="margin-top:10px">Значения сохраняются автоматически в этом браузере. Нажмите «Копировать» чтобы скопировать результат в буфер обмена.</div>
  </div>

<script>
  const $ = id => document.getElementById(id);
  const fields = ['risk','leverage','entry','stop'];

  function parseNum(v){
    if (v === null || v === undefined) return NaN;
    v = String(v).trim().replace(/,/g,'.');
    return Number(v);
  }

  window.addEventListener('DOMContentLoaded', () => {
    fields.forEach(id => {
      const el = $(id);
      if (!el) return;
      const saved = localStorage.getItem('calc_' + id);
      if (saved !== null) el.value = saved;
      el.addEventListener('input', () => { localStorage.setItem('calc_' + id, el.value); });
      el.addEventListener('keydown', (e) => { if(e.key==='Enter'){ e.preventDefault(); safeCalc(); } });
    });

    $('calc')?.addEventListener('click', safeCalc);
    $('clear')?.addEventListener('click', clearAll);
    $('copy')?.addEventListener('click', copyResult);
  });

  function safeCalc(){
    const errEl = $('error');
    const outEl = $('out');
    if(errEl) errEl.textContent = '';
    const risk = parseNum($('risk')?.value);
    const leverage = parseNum($('leverage')?.value);
    const entry = parseNum($('entry')?.value);
    const stop = parseNum($('stop')?.value);
    if (![risk,leverage,entry,stop].every(n=>Number.isFinite(n))){ if(errEl) errEl.textContent='Пожалуйста, заполните все поля валидными числами.'; if(outEl) outEl.textContent='amount = —'; return;}
    if(entry===0){ if(errEl) errEl.textContent='Entry не может быть нулём.'; if(outEl) outEl.textContent='amount = —'; return;}
    const diffRatio=(entry-stop)/entry;
    if(Math.abs(diffRatio)<Number.EPSILON){ if(errEl) errEl.textContent='Разница Entry и Stop слишком мала — деление невозможно.'; if(outEl) outEl.textContent='amount = —'; return;}
    const denominator=leverage*diffRatio;
    if(Math.abs(denominator)<Number.EPSILON){ if(errEl) errEl.textContent='Произведение плеча и разницы равно нулю — проверьте значения.'; if(outEl) outEl.textContent='amount = —'; return;}
    const amount=risk/denominator;
    if(!isFinite(amount)||Number.isNaN(amount)){ if(errEl) errEl.textContent='Получилось недопустимое значение (NaN или бесконечность). Проверьте входные данные.'; if(outEl) outEl.textContent='amount = —'; return;}
    const rounded=Math.round(amount*10000)/10000;
    if(outEl) outEl.textContent='amount = ' + rounded + ' USDT';
  }

  function clearAll(){
    fields.forEach(id=>{ const el=$(id); if(!el) return; el.value=''; localStorage.removeItem('calc_'+id); });
    const outEl=$('out'); const errEl=$('error'); if(outEl) outEl.textContent='amount = —'; if(errEl) errEl.textContent='';
  }

  function copyResult(){
    const outEl=$('out');
    if(!outEl) return;
    const text = outEl.textContent;
    if(!text || text.includes('—')) return;
    // Extract only the numeric value
    const match = text.match(/([\d\.]+)/);
    if(!match) return;
    const numberOnly = match[1];
    navigator.clipboard?.writeText(numberOnly).then(()=>{
      const btn=$('copy'); const prev=btn?.textContent;
      if(btn) btn.textContent='Скопировано';
      setTimeout(()=>{if(btn) btn.textContent=prev;},1200);
    }).catch(()=>alert('Не удалось скопировать'));
  }
</script>
</body>
</html>


